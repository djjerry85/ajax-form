{"version":3,"sources":["s-ajax-form.js"],"names":["$","fn","sAjaxForm","options","defaults","url","settings","extend","showPopup","console","error","getFormValues","$form","res","find","each","attr","val","disposeValidation","removeClass","setValidation","index","item","name","addClass","closest","initForm","form","$el","meta","method","hashtag","data","endpoint","popup","on","e","preventDefault","dataRaw","serializeArray","type","dataType","length","value","files","get","dataF","FormData","i","file","append","processData","contentType","ajax","alert","log","arguments","success","errors","fields","trigger","window","location","hash","closePopup","setTimeout","jQuery"],"mappings":"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","file":"s-ajax-form.js","sourcesContent":["(function ($) {\n    $.fn.sAjaxForm = function (options) {\n        let defaults = {\n                url: '/include/ajax/call.php',\n            },\n            settings = $.extend(defaults, options);\n\n        if (typeof showPopup != 'function') {\n            console.error(\"sAjaxForm: Function 'showPopup' is not defined\");\n        }\n\n        function getFormValues($form) {\n            let res = {};\n            $form.find('input,textarea').each(function () {\n                res[$(this).attr('name')] = $(this).val();\n            });\n            return res;\n        }\n\n        function disposeValidation($form) {\n            $form.find('.bad').removeClass('bad');\n        }\n\n        function setValidation($form, res) {\n            $.each(res, function (index, item) {\n                $form.find('[name=' + item.name + ']').addClass('bad');\n                if (item.name == 'user-consent') {\n                    $form.find('[name=' + item.name + ']').closest('.input_item').addClass('bad');\n                }\n            });\n        }\n\n        function initForm(form) {\n            let $el = $(form);\n            let meta = {\n                method: $el.attr('method') || 'POST',\n                hashtag: $el.data('hashtag'),\n                endpoint: $el.data('endpoint'),\n                popup: $el.data('popup')\n            };\n\n            $el.on('submit', function (e) {\n\n                $el.find('button, input[type=\"submit\"]').attr(\"disabled\", true);\n                e.preventDefault();\n                disposeValidation($el);\n\n\n                let data = {};\n                let dataRaw = $el.serializeArray();\n\n                data = dataRaw;\n\n\n                let options = {\n                    url: settings.url,\n                    type: 'POST',\n                    dataType: 'json',\n                    data: data\n                };\n\n                if ($el.find('input[type=\"file\"]').length) {\n                    data = {};\n                    $.each(dataRaw, function (index, item) {\n                        data[item.name] = item.value;\n                    });\n                    let files = $el.find('input[type=\"file\"]').get(0).files;\n                    let dataF = new FormData();\n                    for (let i = 0; i < files.length; i++) {\n                        let file = files[i];\n\n                        // Check the file type.\n                        /* if (!file.type.match('image.*')) {\n                         continue;\n                         }*/\n\n                        // Add the file to the request.\n                        dataF.append('files[]', file, file.name);\n                    }\n                    $.each(dataRaw, function (index, item) {\n                        dataF.append(item.name, item.value);\n                    });\n                    options.data = dataF;\n                    options.processData = false;\n                    options.contentType = false;\n                }\n\n                $.ajax(\n                    $.extend(options, {\n                        error: function () {\n                            $el.find('button, input[type=\"submit\"]').attr(\"disabled\", false);\n                            alert(\"Во время отправки формы произошла ошибка... Попробуйте еще раз, либо свяжитесь с нами по телефону\");\n                            console.log('Error while submit form');\n                            console.log(arguments);\n                        },\n                        success: function (res) {\n                            $el.find('button, input[type=\"submit\"]').attr(\"disabled\", false);\n                            if (res.errors) {\n                                setValidation($el, res.fields);\n                                $el.trigger('submit-error');\n                            } else {\n                                if (meta.hashtag) {\n                                    window.location.hash = '#' + meta.hashtag;\n                                }\n                                if (meta.popup) {\n                                    closePopup();\n                                    setTimeout(function () {\n                                        showPopup(meta.popup);\n                                    }, 500);\n                                }\n\n                                $el.trigger('submit-success');\n                            }\n                        }\n                    })); //\n            });\n\n\n            $el.find('[data-role=submit]').on('click', function (e) {\n                e.preventDefault();\n                $el.trigger('submit');\n            });\n            $el.on('submit-success', function () {\n                $el.find('textarea, input[type=\"text\"], input[type=\"email\"]').val('');\n            })\n        }\n\n\n        return this.each(function () {\n            initForm(this);\n        });\n    };\n})(jQuery);"]}